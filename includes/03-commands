<h1 id='commands-and-command-handlers-the-write-pipeline'>Commands and Command Handlers - The Write Pipeline</h1>
<p><img src="/images/../img/booster-arch.png" alt="Booster architecture" /></p>

<p>Commands and Command Handlers define the <strong>write</strong> API of your application (highlighted in yellow in the diagram). Commands are objects that are sent to the <code>/commands</code> endpoint. The usage of this endpoint is explained <a href="09-rest-api.md">in the REST API section</a>.</p>

<p>Instead of a controller, like in a traditional architecture like <a href="https://www.martinfowler.com/eaaCatalog/modelViewController.html">MVC</a>, you define a <em>Handler</em> method, which will be in charge of processing the command, calling any third-party services, performing side-effects, and finally, registering <a href="04-events.md">events</a>.</p>

<blockquote>
<p><strong>Note:</strong> Event registration is not mandatory, but we <strong>strongly</strong> recommend registering at least one event for any possible final state, even in the case of a failure, to make your application activity easier to trace and debug.</p>
</blockquote>

<p>A command is a class, decorated with the <code>@Command</code> decorator, that defines a data structure
and a handler method. The method will process the commands and optionally generate and persist
one or more events to the event store.</p>

<p>To create a command, you can do so manually, or by running the generator provided by the <code>boost</code> CLI tool. Let&#39;s create a command to confirm a payment:</p>

<p><code>shell script
boost new:command ConfirmPayment --fields cartID:UUID confirmationToken:string
</code></p>

<p>You can specify as many fields as you want, and Booster will generate a class for you in the <code>src/commands</code> folder that more or less will look like this:</p>
<pre class="highlight typescript tab-typescript"><code><span class="p">@</span><span class="nd">Command</span><span class="p">({</span>
  <span class="na">authorize</span><span class="p">:</span> <span class="s1">'all'</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kr">class</span> <span class="nx">ConfirmPayment</span> <span class="p">{</span>
  <span class="k">public</span> <span class="kd">constructor</span><span class="p">(</span><span class="k">readonly</span> <span class="nx">cartID</span><span class="p">:</span> <span class="nx">UUID</span><span class="p">,</span> <span class="k">readonly</span> <span class="nx">confirmationToken</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">public</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">register</span><span class="p">:</span> <span class="nx">Register</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="c1">// implementation for the handler</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>The <code>handle</code> method is the Handler we were talking about some paragraphs ago. Here you can write arbitrary code like integration with 3rd party services, data validation, and any other side effect that your application requires.</p>

<p>Again, we strongly advise that after a command has been executed, even if it didnâ€™t succeed, you <code>register</code> an event
specifying what happened. This also goes in the <code>handle</code> method, and thatâ€™s what the <code>register</code> parameter is used for:</p>
<pre class="highlight typescript tab-typescript"><code><span class="k">public</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">register</span><span class="p">:</span> <span class="nx">Register</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="c1">// i.e. code that performs a payment</span>
  <span class="nx">register</span><span class="p">.</span><span class="nx">events</span><span class="p">(</span><span class="k">new</span> <span class="nx">CartPaid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cartId</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">confirmationToken</span><span class="p">))</span>
<span class="p">}</span>
</code></pre>
<p>Note how no magic happened here yet. The only thing that is needed for Booster to know that this class is a
command, is the <code>@Command</code> decorator. Apart from that, the generator only writes code, nothing else!
You could achieve the same result by writing the class yourself ðŸ˜‰</p>

<p>Continue reading about <a href="04-events.md">Events</a>!</p>
